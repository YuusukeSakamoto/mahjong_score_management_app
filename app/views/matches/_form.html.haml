.row.d-flex.justify-content-center
  .col-10.col-md-8
    .info.mb-3.mx-2.fs-sm.text-main.text-center
      .info-content.text-start
        %i.bx.bxs-info-circle.pe-1.text-pink{style: "padding-top: 1px;"}
        %span.mb-0.fw-bold ptは全ての得点を入力後に自動計算されます
      .info-content.text-start
        %i.bx.bxs-info-circle.pe-1.text-pink{style: "padding-top: 1px;"}
        %span.mb-0.fw-bold ptを手動で変更することも可能です
      
  .col-10.col-md-8
    = form_with model: @match, class: 'mb-4', local: true do |f|
      = render 'layouts/validation_error', instance: @match
      = f.hidden_field :player_id, value: current_player.id
      = f.hidden_field :play_type
      - if @league.present?
        = f.hidden_field :league_id, value: @league.id
      .d-flex.justify-content-between
        #div
          = f.label :ルール, class: 'title-p text-main'
          %span.p_required 必須
          - if recording? || ["edit", "update"].include?(controller.action_name)
            %span.p_warning ※変更不可
      = f.collection_select(:rule_id, current_player.rule_list(@match.play_type),
                            :id, :name,
                            { selected: session[:rule] },
                            class: 'form-control py-md-1 rounded bg-white box-shadow mb-1 text-center' )
      %button.js-rule-dropdown.mb-1.fs-sm.text-main{ type: 'button' }
        %i.fa-solid.fa-caret-right
        %span.ps-1 詳細
      .js-rule-details{ style: "display: none;" }
        .js-rule.mb-2

      .mb-2
        = f.label :対局日, class: 'title-p text-main'
        %span.p_required 必須
        - if controller.action_name == "edit"
          = f.date_field :match_on, value: @match.match_on, autofocus: true, 
            class: 'form-control py-md-1 rounded bg-white box-shadow mb-1 text-center'
        - else 
          = f.date_field :match_on, value: Date.today, autofocus: true, 
            class: 'form-control py-md-1 rounded bg-white box-shadow mb-1 text-center'
      .d-flex.align-items-end.mb-2
        %span.title-p.text-main.mb-0 得点
        %span.p_required 必須
        .d-flex.align-items-center
          %i.fa-solid.fa-circle-info.text-pink.fs-sm.ps-4.pe-1
          .js-remaining_score.text-main.fw-bold 残得点：
      // 選択されたプレイヤー分だけフォーム表示   
      - i = 0
      = f.fields_for :results do |result|
        .mb-2
          // 大文字変換対策
          - player_name = @players[i]['name']  
          = result.label :name, player_name, class: 'text-main fw-bold'
          .d-flex.align-items-end.justify-content-between
            - if @match.results[i].ie.nil?
              = result.select :ie, 
                Result::IE , { selected: i + 1 }, 
                {class: 'form-control px-0 py-1 py-md-1 rounded bg-white box-shadow w-25 text-center'}    
            - else
              = result.select :ie, 
                Result::IE , { selected: @match.results[i].ie }, 
                {class: 'form-control px-0 py-1 py-md-1 rounded bg-white box-shadow w-25 text-center'}    
            %p.text-main.mb-0.mx-1.mx-md-2 家

            = result.number_field :score, autofocus: true, step: "100",
              class: "form-control py-1 py-md-1 rounded bg-white box-shadow text-center"
            %p.text-main.mb-0.mx-1.mx-md-2 点

            = result.number_field :point, autofocus: true, step: "0.1",
              class: 'form-control py-1 py-md-1 rounded box-shadow w-50 text-center'
            %p.text-main.mb-0.mx-1.mx-md-2 pt

            = result.hidden_field :player_id, value: @players[i]['id']
            = result.hidden_field :rank, value: @match.results[i].rank
        - i += 1

      .my-4
        = f.label :'対局メモ', class: 'title-p text-main'
        %button.js-memo-dropdown.mb-1.text-main{ type: 'button' }
          %i.fa-solid.fa-caret-right.text-green
          %i.fa-regular.fa-pen-to-square.text-green
        .js-memo-details{ style: "display: none;" }
          = f.text_area :memo, autofocus: true, 
            class: 'form-control py-md-1 rounded bg-white box-shadow mb-1'

      .col-8.col-md-5.m-auto
        - if ["edit", "update"].include?(controller.action_name)
          .mt-3
            = f.button type: 'submit', class: 'main-btn--orange w-100', id: "match_create_btn" do
              .btn-text
                %i.fa-regular.fa-circle-check.pe-1.fw-bold
                %span 更新
        - else 
          .d-flex.justify-content-center
            = f.button type: 'submit', class: 'main-btn--orange w-100' , id: "match_create_btn" do
              .btn-text
                %i.fa-solid.fa-pen.pe-1.fw-bold
                %span 登録
      .col-8.col-md-7.m-auto.mt-1
        .d-flex.justify-content-center.align-items-center#match_create_warning
          %i.fa-solid.fa-triangle-exclamation.text-warning.fs-sm.pe-1
          %p.fs-sm.text-main.fw-bold.mb-0 残得点が0ではありません