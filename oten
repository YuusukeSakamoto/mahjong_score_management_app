
[1mFrom:[0m /home/ec2-user/environment/mahjong_score_management_app/app/controllers/matches/calculates_controller.rb:29 Matches::CalculatesController#get_points_ranks:

    [1;34m23[0m: [32mdef[0m [1;34mget_points_ranks[0m(scores, rule_id)
    [1;34m24[0m:   rule = [1;34;4mRule[0m.find(rule_id)
    [1;34m25[0m:   sorted_scores = scores.sort.reverse [1;34m# スコアで降順にする[0m
    [1;34m26[0m:   ranks = scores.map{|score| sorted_scores.index(score) + [1;34m1[0m} [1;34m# 順位を配列で取得する[0m
    [1;34m27[0m:   binding.pry
    [1;34m28[0m:   [1;34m# 素点の配列を作成[0m
 => [1;34m29[0m:   soten = scores.map{ |score| get_soten(score, rule) }
    [1;34m30[0m:   [1;34m# 小数点計算方法に従った素点を計算する[0m
    [1;34m31[0m:   calculated_soten = calculate_decimal_point(soten, rule)
    [1;34m32[0m:   uma_ary = [rule.uma_1, rule.uma_2, rule.uma_3, rule.uma_4]    
    [1;34m33[0m:   [1;34m# ウマをptに反映させる[0m
    [1;34m34[0m:   points = calculated_soten.map.with_index{ |n, i| n += uma_ary[ranks[i] - [1;34m1[0m] }
    [1;34m35[0m:   [1;34m# オカをptに反映させる[0m
    [1;34m36[0m:   oka = ((rule.kaeshi - rule.mochi ) * session[[33m:players[0m].count) / [1;34m1000[0m.to_f
    [1;34m37[0m:   points[ranks.index([1;34m1[0m)] += oka [1;34m# 1位のptにウマを追加する[0m
    [1;34m38[0m:   [32mreturn[0m points, ranks
    [1;34m39[0m: [32mend[0m

